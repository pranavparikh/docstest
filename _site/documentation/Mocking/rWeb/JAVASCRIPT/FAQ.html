<!DOCTYPE html>
<html>
<head>
	<title>Test Armada</title>
	<link rel="stylesheet" type="text/css" href="/css/normalize.css">
	<link rel="stylesheet" type="text/css" href="/css/common.css">
	<link rel="stylesheet" type="text/css" href="/css/header.css">
	<link rel="stylesheet" type="text/css" href="/css/home.css">
	<link rel="stylesheet" type="text/css" href="/css/doc.css">
	<link rel="stylesheet" type="text/css" href="/css/training.css">
	<link rel="stylesheet" type="text/css" href="/css/faq.css">
	<link rel="stylesheet" type="text/css" href="/css/contact.css">
	<link rel="stylesheet" type="text/css" href="/css/search.css">
	<link rel="stylesheet" type="text/css" href="/css/slick.css">
	<link rel="stylesheet" type="text/css" href="/css/prism.css">
	<link rel="stylesheet" type="text/css" href="/css/responsive.css">
</head>
<body>
	
	<header>
		<a href="/">
			<img src="/documentation/images/ta-logo.png" class="logo" alt="Main Brand Logo"
				 srcset="/documentation/images/ta-logo@2x.png 2x, /documentation/images/ta-logo@3x.png 3x">
		</a>
		<form action="/search" method="get">
			<input type="text" id="search-box" name="query" placeholder="Search" class="search-box">
			<div class="select-box">
				<select name="fleet" id="fleet-box" onchange="document.getElementById('search-box').focus();">
					<option value="all">All Fleets</option>
					
					<option value="Performance Testing">Performance Testing</option>
					
					<option value="Functional Testing">Functional Testing</option>
					
					<option value="Mocking">Mocking</option>
					
					<option value="Data Insights">Data Insights</option>
					
				</select>
			</div>
		</form>
		<div class="nav-links">
			<div class="nav-links__fleets">
				<a class="nav-links__fleets-btn">
					Fleets <img src="/images/arrow-down-icon.png" class="arrow-down-icon"
								srcset="/images/arrow-down-icon@2x.png 2x,
										/images/arrow-down-icon@3x.png 3x">
				</a>
				<div class="nav-links__fleets-content">
					<a href="/">
						All Fleets
					</a>
					
					<a href="/Performance Testing/">
						Performance Testing
					</a>
					
					<a href="/Functional Testing/">
						Functional Testing
					</a>
					
					<a href="/Mocking/">
						Mocking
					</a>
					
					<a href="/Data Insights/">
						Data Insights
					</a>
					
				</div>
			</div>
			
			
			
			<a href="https://github.com/pranavparikh/docstest" target="_blank" class="nav-links__main-links">GitHub</a>
			
		</div>
	</header>

	<div class="container">
		  <div class="clear"></div>
<div class="doc-container">
  <div class="breadcrumb doc-breadcrumb">
    <p>
      <a class="breadcrumb__link" href="/">Home</a>
      <img src="/images/arrow-right-icon.png"
           srcset="/images/arrow-right-icon@2x.png 2x,
                   /images/arrow-right-icon@3x.png 3x"
           class="arrow-right-icon">
      <a class="breadcrumb__link" href="/Mocking/">Mocking</a>
      <img src="/images/arrow-right-icon.png"
           srcset="/images/arrow-right-icon@2x.png 2x,
                   /images/arrow-right-icon@3x.png 3x"
           class="arrow-right-icon">
      <span class="breadcrumb__current-page">rWeb JAVASCRIPT</span>
    </p>
  </div>
  <div class="clear"></div>
  <div class="sidebar">
    <ul>
    
    
    
    
    
    
    
    
    
    
      
      
        
          
          
            
            <li><a href="/documentation/Mocking/rWeb/JAVASCRIPT/Introduction" class="sidebar__file-links">
              Introduction
            </a></li>
            
          
        
      
        
          
          
            
            <li><a href="/documentation/Mocking/rWeb/JAVASCRIPT/Getting Started" class="sidebar__file-links">
              Getting Started
            </a></li>
            
          
        
      
        
          
            
            
              <li class="sidebar__file-links">Developer Guide</li>
            
          
          
          
            
            <li><a href="/Mocking/rWeb/JAVASCRIPT/Training Guide" class="sidebar__file-links sidebar__file-sublink">
              Training Guide
            </a></li>
            
          
        
      
        
          
          
          
            
            <li><a href="/documentation/Mocking/rWeb/JAVASCRIPT/API Guide" class="sidebar__file-links sidebar__file-sublink">
              API Guide
            </a></li>
            
          
        
      
        
          
          
            
            <li><a href="/documentation/Mocking/rWeb/JAVASCRIPT/Contribution Guide" class="sidebar__file-links">
              Contribution Guide
            </a></li>
            
          
        
      
        
          
          
            
            <li><a href="/documentation/Mocking/rWeb/JAVASCRIPT/FAQ" class="sidebar__file-links sidebar__file-links-current">
              FAQ
            </a></li>
            
          
        
      
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    </ul>
  </div>
  <div class="doc-content markdown">
    <h2 id="what-can-be-mocked">What Can Be Mocked?</h2>
<p>Any Restful service API can be mocked such as:</p>

<ul>
  <li>GET</li>
  <li>POST</li>
  <li>PUT</li>
  <li>DELETE</li>
  <li>OPTIONS</li>
  <li>and so on..</li>
</ul>

<p><br /></p>

<h2 id="can-ajax-calls-be-mocked">Can AJAX Calls Be Mocked?</h2>
<p>Yes - It is same as for any other backend service. For AJAX call, point it to the mocked server instance instead of 
the actual back end service and add a mocked route in the file containing mocked routes for mock server.</p>

<p><br /></p>

<h2 id="what-are-the-pre-requisites">What Are The Pre-Requisites?</h2>
<ul>
  <li>node.js 4+ (npm is included in the package)</li>
</ul>

<p><br /></p>

<h2 id="how-can-i-add-mock-server-dependency-to-my-node-project">How Can I Add Mock Server Dependency To My Node Project?</h2>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="s2">"dependencies"</span><span class="err">:</span> <span class="p">{</span>
  <span class="s2">"shifu"</span><span class="err">:</span> <span class="s2">"1.0.0"</span> <span class="c1">// add the latest version</span>
<span class="p">}</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-add-a-mocked-route">How To Add A Mocked Route?</h2>
<p>Add the following code in your routes file, typically <code class="highlighter-rouge">endpoints.js</code></p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'helloWorld'</span><span class="p">,</span>                 <span class="c1">// required</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Hello World'</span><span class="p">,</span>             <span class="c1">// Used for Mock Server UI</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/helloWorld'</span><span class="p">,</span>              <span class="c1">// the path you want to mock</span>
  <span class="na">method</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>                    <span class="c1">// The Rest Method you want to mock for this API</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// Add Logic to massage data before returning back to the request.</span>
    <span class="nx">reply</span><span class="p">(</span><span class="s1">'Hello World'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="why-do-i-see-no-routes-defined-for-this-path-">Why do I see <code class="highlighter-rouge">No routes defined for this path</code> ?</h2>
<p>Any undefined routes in Shifu will be responsed with a user friendly message <code class="highlighter-rouge">No routes defined for this path</code>.</p>

<p><br /></p>

<h2 id="how-to-create-dynamic-urls">How To Create Dynamic URLs?</h2>
<p>By adding the URL part in curly brackets that you would liek to by dynamic such as <code class="highlighter-rouge">/get/customerInfo/{customerid}/{zipcode}</code></p>

<p>For example:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'customerInfo'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Customer Info'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/get/customerInfo/{customerid}/{zipcode}'</span><span class="p">,</span> <span class="c1">// both customerid and zipcode will be dynamic</span>
  <span class="na">method</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">variantLabel</span><span class="p">:</span> <span class="s1">'Get Customer Info'</span><span class="p">,</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">reply</span><span class="p">(</span><span class="s1">'How to read the customer id :('</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-read-dynamic-urls-in-request">How To Read Dynamic URLs In Request?</h2>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">shifu</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'shifu'</span><span class="p">);</span>
<span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/get/customerInfo/{customerid}/{zipcode}'</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span> 
    <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">customerid</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">customerid</span><span class="p">;</span> <span class="c1">// customerid is 123 if request is "/get/customerInfo/123/92127"</span>
    <span class="kd">var</span> <span class="nx">zipcode</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">zipcode</span><span class="p">;</span>       <span class="c1">// zipcode is 92127 if request is "/get/customerInfo/123/92127"</span>
  <span class="p">}</span>
<span class="p">});</span> 
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-read-header-parameters-in-request">How To Read Header Parameters In Request?</h2>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">shifu</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'shifu'</span><span class="p">);</span>
<span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/api/getCart'</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">headers</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">raw</span><span class="p">.</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">authorization</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">.</span><span class="nx">authorization</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">authorization</span><span class="p">)</span> <span class="p">{</span>
       <span class="c1">// do something</span>
    <span class="p">}</span>
    <span class="nx">reply</span><span class="p">().</span><span class="nx">code</span><span class="p">(</span><span class="mi">204</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span> 
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-read-payload-in-request">How To Read Payload In Request?</h2>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">shifu</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'shifu'</span><span class="p">);</span>
<span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/api/getCart'</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>
    <span class="c1">// foo would be "bar" if the posted body content (as JSON) is {"foo": "bar"}</span>
    <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span> 
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-read-query-parameters-in-request">How To Read Query Parameters In Request?</h2>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">shifu</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'shifu'</span><span class="p">);</span>
<span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/api/getCart'</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">queryParams</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
    <span class="c1">// foo would be "bar" if incoming request is "/api/getCart?foo=bar"</span>
    <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">queryParams</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span> 
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-read-url-parameters-in-request-">How to read url parameters in request ?</h2>

<p>To read the dynamic URL parameters in request with in the route, use <code class="highlighter-rouge">request.params</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>var shifu = require('shifu');
shifu.route({
  path: '/api/customer/{id}'
  handler: function(req, reply) {
    // would be "123" if the endpiont hit was "/api/customer/123"
    var id = request.params.id;
  }
});
</code></pre>
</div>

<p><br /></p>
<h2 id="how-to-add-delay-to-response-">How to add delay to response ?</h2>

<p>A mocked response can also be delayed by some time specified by the user. You can simulate a delay (in ms) by passing delay as follows :</p>
<div class="highlighter-rouge"><pre class="highlight"><code>shifu.route({
  id: 'message',
  label: 'Hello Variants',
  path: '/message',

  variantLabel: 'hello world',
  handler: function (req, reply) {
    shifu.util.respondWithFile(this, reply, {code: 202});
  }
})
.variant({
    id: 'variant with delay',
    label: 'variant with delay',
    handler: function (req, reply) {
      shifu.util.respondWithFile(this, reply, {filePath: './message/GET/variant_with_delay.json', delay: 1000});
    }
  });
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-set-custom-headers-in-mocked-response">How To Set Custom Headers In Mocked Response?</h2>
<h3 id="preferred-way">Preferred Way</h3>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'header'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Test Headers'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/api/testHeaders'</span><span class="p">,</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">myHeaders</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">header1</span><span class="p">:</span> <span class="s1">'test1'</span><span class="p">,</span>
      <span class="na">header2</span><span class="p">:</span> <span class="s1">'test2'</span><span class="p">,</span>
      <span class="na">header3</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">};</span>
    <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">respondWithFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">reply</span><span class="p">,</span> <span class="p">{</span><span class="na">headers</span><span class="p">:</span> <span class="nx">myHeaders</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<h3 id="alternate-way">Alternate Way</h3>

<p>To set custom headers, call <code class="highlighter-rouge">header(name, value, options)</code> on reply object, where</p>

<p><code class="highlighter-rouge">name</code> is the header name
<code class="highlighter-rouge">value</code> is the header value
<code class="highlighter-rouge">options</code> is an optional object with the following attributes</p>

<table>
  <thead>
    <tr>
      <th>Attribute</th>
      <th style="text-align: center">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>append</td>
      <td style="text-align: center">if <code class="highlighter-rouge">true</code>, the value is appended to any existing header value using separator. Defaults to <code class="highlighter-rouge">false</code>.</td>
    </tr>
    <tr>
      <td>separator</td>
      <td style="text-align: center">string used as separator when appending to an exiting value. Defaults to <code class="highlighter-rouge">','</code></td>
    </tr>
    <tr>
      <td>override</td>
      <td style="text-align: center">if <code class="highlighter-rouge">false</code>, the header value is not set if an existing value present. Defaults to <code class="highlighter-rouge">true</code></td>
    </tr>
    <tr>
      <td>duplicate</td>
      <td style="text-align: center">if <code class="highlighter-rouge">false</code>, the header value is not modified if the provided value is already included. Does not apply when append is false or if the name is ‘set-cookie’. Defaults to <code class="highlighter-rouge">true</code></td>
    </tr>
  </tbody>
</table>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'Get Collection'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Get Collections'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/product/grouping/api/collection/{collectionId}'</span><span class="p">,</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">reply</span><span class="p">({</span><span class="na">message</span><span class="p">:</span> <span class="s1">'test'</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s1">'X-Res-Header'</span><span class="p">,</span> <span class="s1">'I\'m a custom response header'</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-set-custom-cookies-in-mocked-response">How To Set Custom Cookies In Mocked Response?</h2>
<h3 id="preferred-way-1">Preferred Way</h3>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'cookie'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Test Cookies'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/api/testCookies'</span><span class="p">,</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s1">'com.wm.customer'</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'vz7.0b5c56'</span><span class="p">},</span>
      <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s1">'CID'</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'SmockedCID'</span><span class="p">,</span> <span class="na">options</span><span class="p">:</span> <span class="p">{</span><span class="na">domain</span><span class="p">:</span> <span class="s1">'domain'</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="s1">'/'</span><span class="p">}},</span>
      <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s1">'anotherCookie'</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'cookieValue'</span><span class="p">}</span>
    <span class="p">];</span>
    
    <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">respondWithFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">reply</span><span class="p">,</span> <span class="p">{</span><span class="na">cookies</span><span class="p">:</span> <span class="nx">cookies</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<h3 id="alternate-way-1">Alternate Way</h3>
<p>To set custom cookies, call <code class="highlighter-rouge">state(name, value, options)</code> on reply object, where 
<code class="highlighter-rouge">name</code> is the cookie name
<code class="highlighter-rouge">value</code> is the cookie value
<code class="highlighter-rouge">options</code> is the server state options settings found <a href="https://hapijs.com/api#serverstatename-options">here</a></p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'Get Collection'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Get Collections'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/product/grouping/api/collection/{collectionId}'</span><span class="p">,</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">reply</span><span class="p">({</span><span class="na">message</span><span class="p">:</span> <span class="s1">'test'</span><span class="p">})</span>
       <span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="s1">'test-cookie'</span><span class="p">,</span> <span class="s1">'I\'m a custom response cookie'</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">});</span>  
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-set-cors-headers">How To Set CORS Headers?</h2>

<p>The <a href="https://www.w3.org/TR/cors/">Cross-Origin Resource Sharing</a> protocol allows browsers to make cross-origin API calls. CORS is required by web application running inside a browser which are loaded from a different domain than the API server. CORS headers are disabled by default. To enable, set <code class="highlighter-rouge">cors</code> to true, or to an object with the following options:</p>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th style="text-align: center">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>origin</td>
      <td style="text-align: center">a string array of allowed origin servers <code class="highlighter-rouge">Access-Control-Allow-Origin</code>. Defaults to any origin [‘*’]</td>
    </tr>
    <tr>
      <td>maxAge</td>
      <td style="text-align: center">number of seconds the browser should cache the CORS response (‘Access-Control-Max-Age’). The greater the value, the longer it will take before the browser checks for changes in policy. Defaults to 86400 (one day).</td>
    </tr>
    <tr>
      <td>headers</td>
      <td style="text-align: center">string array of allowed headers <code class="highlighter-rouge">Access-Control-Allow-Headers</code>. Defaults to <code class="highlighter-rouge">['Authorization', 'Content-Type', 'If-None-Match']</code>.</td>
    </tr>
    <tr>
      <td>additionalHeaders</td>
      <td style="text-align: center">string array of additional headers to headers. Use this to keep the default headers in place.</td>
    </tr>
    <tr>
      <td>methods</td>
      <td style="text-align: center">string array of allowed HTTP methods Access-Control-Allow-Methods. Defaults to <code class="highlighter-rouge">['GET', 'HEAD', 'POST', 'PUT', 'DELETE', 'OPTIONS']</code></td>
    </tr>
    <tr>
      <td>additionalMethods</td>
      <td style="text-align: center">string array of additional methods to methods. Use this to keep the default methods in place</td>
    </tr>
    <tr>
      <td>exposedHeaders</td>
      <td style="text-align: center">string array of exposed headers Access-Control-Expose-Headers. Defaults to <code class="highlighter-rouge">['WWW-Authenticate', 'Server-Authorization'</code></td>
    </tr>
    <tr>
      <td>additionalExposedHeaders</td>
      <td style="text-align: center">a string array of additional headers to exposedHeaders. Use this to keep the default headers in place.</td>
    </tr>
    <tr>
      <td>credentials</td>
      <td style="text-align: center">if true, allows user credentials to be sent Access-Control-Allow-Credentials. Defaults to false.</td>
    </tr>
  </tbody>
</table>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">corsHeaders</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">origin</span><span class="p">:</span> <span class="p">[</span><span class="s1">'*'</span><span class="p">],</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Access-Control-Allow-Headers"</span><span class="p">,</span> <span class="s2">"Origin, X-Requested-With, Content-Type, Accept"</span><span class="p">],</span>
  <span class="na">credentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Items</span>
<span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'tempo'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Tempo'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/tempo1'</span><span class="p">,</span>
    
  <span class="na">config</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">cors</span><span class="p">:</span> <span class="nx">corsHeaders</span>
  <span class="p">},</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">respondWithFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">reply</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="what-is-respondwithfile-utility">What Is <code class="highlighter-rouge">respondWithFile</code> Utility?</h2>
<p>This feature allows you to respond with a data stored in a file instead of hard coding the response data in the routes definition. This way user does not have to hard-code/change the response in handler and rather can just swap the file with different data without even bringing the server down.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>  <span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
      <span class="na">id</span><span class="p">:</span> <span class="s1">'ResponseFromFile'</span><span class="p">,</span>
      <span class="na">label</span><span class="p">:</span> <span class="s1">'Response From File'</span><span class="p">,</span>
      <span class="na">path</span><span class="p">:</span> <span class="s1">'/get/fromFile'</span><span class="p">,</span>
      <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">respondWithFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">reply</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">});</span>
</code></pre>
</div>
<p>In the above example, mock server will automatically look for a file <code class="highlighter-rouge">default.{some_extension}</code>  at <code class="highlighter-rouge">./mocked-data/get/fromFile/GET/default.{some_extension}</code></p>

<p><br /></p>

<h2 id="how-file-path-is-calculated-for-respondwithfile-utility">How File Path Is Calculated For <code class="highlighter-rouge">respondWithFile</code> Utility?</h2>
<p>The path to the mocked data file is auto-calculated based on the route path. For example if the route path is /get/cart than for the default variant, mock server will look for the <code class="highlighter-rouge">default.{some_extension}</code> file at <code class="highlighter-rouge">./mocked-data/get/fromFile/GET/default.{some_extension}</code>. For variants, the name of the file should be changed from default to the variant name as shown below:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'ResponseFromFile'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Response From File'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/get/fromFile'</span><span class="p">,</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">respondWithFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">reply</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="p">.</span><span class="nx">variant</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'textData'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Text Data'</span><span class="p">,</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">respondWithFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">reply</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>
<p>In above example mock server will look for <code class="highlighter-rouge">./resources/mocked-data/get/fromFile/GET/textData.{some_extension} file for the variant textData</code></p>

<p><br /></p>

<h2 id="can-i-provide-a-custom-file-location-respondwithfile-utility">Can I Provide A Custom File Location <code class="highlighter-rouge">respondWithFile</code> Utility?</h2>
<p>Yes. By adding <code class="highlighter-rouge">filePath</code> parameter as shown in below example:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'CustomResponseFile'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Response From Custom Path'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/get/customFile'</span><span class="p">,</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">respondWithFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">reply</span><span class="p">,</span> <span class="p">{</span><span class="na">filePath</span><span class="p">:</span> <span class="s1">'./custom.json'</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>
<p>In above example mock server will look for the file under MockedDirectory only but at <code class="highlighter-rouge">./mocked-data/custom.json</code></p>

<p><br /></p>

<h2 id="how-to-respond-only-with-code">How To Respond Only With Code?</h2>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'message'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'hello message'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/message'</span><span class="p">,</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">reply</span><span class="p">().</span><span class="nx">code</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="can-i-return-a-response-code-with-respondwithfile-utility">Can I Return A Response Code With <code class="highlighter-rouge">respondWithFile</code> Utility?</h2>
<p>Yes - by adding <code class="highlighter-rouge">code</code> parameter as shown in below example:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'message'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'hello message'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/message'</span><span class="p">,</span>
 
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">respondWithFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">reply</span><span class="p">,</span> <span class="p">{</span><span class="na">code</span><span class="p">:</span> <span class="mi">400</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="what-is-mockeddirectory-path">What Is MockedDirectory Path?</h2>
<p>Mocked directory path is the location to the base directory where all your mocked response file will be stored. This parameter is defined in run-mock-server-console.js file. It is defined at the start of mock server as shown in the code below:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">require</span><span class="p">(</span><span class="s1">'./endpoints'</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">'shifu'</span><span class="p">).</span><span class="nx">start</span><span class="p">({</span>
  <span class="na">host</span><span class="p">:</span> <span class="s2">"localhost"</span><span class="p">,</span>
  <span class="na">mockedDirectory</span><span class="p">:</span> <span class="s2">"./resources/mocked-data"</span><span class="p">,</span>
  <span class="na">port</span><span class="p">:</span> <span class="mi">8000</span><span class="p">,</span>
  <span class="na">project</span><span class="p">:</span> <span class="s1">'HelloShifu'</span>
<span class="p">});</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="location-for-response-file-for-respondwithfile">Location For Response File For RespondWithFile?</h2>
<p>If you have set your default folder to be <code class="highlighter-rouge">mocked-data</code>, then based on your URL path:</p>

<p>For default variant, mock server will look for <code class="highlighter-rouge">./mocked-data/product/grouping/api/collection/GET/default.json</code> 
and for <code class="highlighter-rouge">mixItem</code> variant mock server will look for <code class="highlighter-rouge">./mocked-data/product/grouping/api/collection/GET/mixItem.json</code></p>

<p><br /></p>

<h2 id="what-are-variants">What Are Variants?</h2>
<p>Variants allows to return a different data set for a given mocked route. Variants can be selected either in the admin UI or through automation APIs to determine what type of response a route should have. Routes are defined using the variant method on the Route object (returned by calling the route method). An object parameter is provided with the following attributes</p>

<ul>
  <li>id: the variant id - used for the RESTful admin API and profile settings</li>
  <li>label: (optional) the variant label - used for display on the admin panel</li>
  <li>handler: (optional) the HAPI route handler which provides the route response</li>
</ul>

<p>Variants are useful because they allow you to test multiple scenarios that can happen with your route. Say, for example, you have a route exposing the ability to update a password. You might have several exceptional scenarios that you would want to test out (each could be a variant that you simply select to tell the route handler to use the appropriate response)</p>
<ul>
  <li>the password was reset successfully</li>
  <li>the password didn’t pass validation</li>
  <li>the old password wasn’t entered correctly</li>
  <li>the username doesn’t exist</li>
  <li>and so on…</li>
</ul>

<p><br /></p>

<h2 id="how-to-add-a-variant-to-a-route">How To Add A Variant To A Route?</h2>
<p>To add a one or more variants do the following:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'message'</span><span class="p">,</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'Message'</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="s1">'/get/message'</span><span class="p">,</span>
  <span class="na">method</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">variantLabel</span><span class="p">:</span> <span class="s1">'Hello'</span><span class="p">,</span>
  <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">reply</span><span class="p">(</span><span class="s1">'Hello'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})</span>
 
<span class="p">.</span><span class="nx">variant</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="s1">'hello'</span><span class="p">,</span>
    <span class="na">label</span><span class="p">:</span> <span class="s1">'Hello World'</span><span class="p">,</span>
    <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">reply</span><span class="p">(</span><span class="s1">'Hello World'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span>

<span class="p">.</span><span class="nx">variant</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="s1">'hello'</span><span class="p">,</span>
    <span class="na">label</span><span class="p">:</span> <span class="s1">'Hello Universe'</span><span class="p">,</span>
    <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">reply</span><span class="p">(</span><span class="s1">'Hello Universe'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>  
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-switch-variants-in-test-case">How To Switch Variants In Test Case?</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>browser.setMockVariant({ fixture: "fixture id", variant: "variant id" }); 
</code></pre>
</div>

<p><br /></p>

<h2 id="how-to-switch-variants-with-http-call">How To Switch Variants With HTTP Call?</h2>
<p>You can also switch the variants via HTTP call (Recommended only when not using Shifu as a library). As an example, if you want to set variant to <code class="highlighter-rouge">helloUniverse</code> for the route below:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>  <span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="s1">'helloWorld'</span><span class="p">,</span>
    <span class="na">label</span><span class="p">:</span> <span class="s1">'Hello World'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="s1">'/helloWorld'</span><span class="p">,</span>
    <span class="na">method</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
    <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">reply</span><span class="p">(</span><span class="s1">'Hello World'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">variant</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="s1">'helloUniverse'</span><span class="p">,</span>
    <span class="na">label</span><span class="p">:</span> <span class="s1">'Hello Universe'</span><span class="p">,</span>
    <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">reply</span><span class="p">(</span><span class="s1">'Hello Universe'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>curl  -H "Content-type: application/json" -X POST -d '{"variant":"&lt;variant&gt;"}' &lt;host&gt;:&lt;port&gt;/shifu/api/route/&lt;routeId&gt;
</code></pre>
</div>

<p>So for the above route, you can switch the variant to <code class="highlighter-rouge">helloUniverse</code> like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl  -H "Content-type: application/json" -X POST -d '{"variant":"helloUniverse"}' http://localhost:8000/shifu/api/route/helloWorld
</code></pre>
</div>

<p>When using parallel sessions, if you want to switch a variant for a route for a particular session, register the session with mock server like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl &lt;host&gt;:&lt;port&gt;/shifu/api/registerSession

// e.g 
curl http://localhost:8000/shifu/api/registerSession
</code></pre>
</div>

<p>If sessions are available, mock server will return a response like:</p>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="w"> </span><span class="p">{</span><span class="nt">"session"</span><span class="p">:</span><span class="s2">"33b08d"</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Extract the session id from response and append it to the route id you want to switch variant for e.g:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>curl -H "Content-type: application/json" -X POST -d "variant":"helloUniverse"}' http://localhost:8000/shifu/api/route/helloWorld-33b08d
</code></pre>
</div>

<p><br /></p>

<h2 id="what-is-mock-server-ui-used-for">What Is Mock Server UI Used For?</h2>
<p>UI can be used to view and test mocked routes as well as for manual switching of variants when running tests manually.</p>

<p><br /></p>

<h2 id="what-is-parallel-sessions">What Is Parallel Sessions?</h2>
<p>Parallel sessions allows you to run multiple instance of server virtually while running only one server. This is helpful when you are running multiple test cases which access the same routes but different variants as parallel sessions allow you to set different variants on same routes without conflicting. This saves CPU and RAM both as only one server is running instead of multiple. Please see the call flow explaination without and with Parallel Sessions Below:</p>

<h3 id="call-flow-without-parallel-sessions">Call Flow Without Parallel Sessions</h3>
<p><img src="../../images/shifu_without_parallel_sessions.png?raw=true" alt="without_parallel_sessions" title="Shifu Without Parallel Sessions" /></p>

<h3 id="call-flow-with-parallel-sessions">Call Flow With Parallel Sessions</h3>
<p><img src="../../images/shifu_with_parallel_sessions.png?raw=true" alt="with_parallel_sessions" title="Shifu With Parallel Sessions" /></p>

<p><br /></p>

<h2 id="how-can-i-enable-parallel-sessions-on-mock-server">How Can I Enable Parallel Sessions On Mock Server?</h2>
<p>Add <code class="highlighter-rouge">sessions</code> parameter with number of virtual services you want as shown in below example while startung mock Server.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">require</span><span class="p">(</span><span class="s1">'./endpoints'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">shifu</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'shifu'</span><span class="p">);</span>
<span class="nx">shifu</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
  <span class="na">host</span><span class="p">:</span> <span class="s2">"localhost"</span><span class="p">,</span>
  <span class="na">mockedDirectory</span><span class="p">:</span> <span class="s2">"./resources/mocked-data"</span><span class="p">,</span>
  <span class="na">port</span><span class="p">:</span> <span class="mi">8000</span><span class="p">,</span>
  <span class="na">sessions</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="na">project</span><span class="p">:</span> <span class="s1">'HelloShifu'</span>
<span class="p">});</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="how-can-i-register-a-session-for-parallel-sessions">How Can I Register a Session For Parallel Sessions?</h2>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">sessionId</span> <span class="o">=</span> <span class="nx">shifu</span><span class="p">.</span><span class="nx">registerSession</span><span class="p">();</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="how-can-i-close-a-session-for-parallel-sessions">How Can I Close A Session For Parallel Sessions?</h2>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">closeSession</span> <span class="o">=</span> <span class="nx">shifu</span><span class="p">.</span><span class="nx">closeSession</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">);</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="does-mock-server-has-any-utility-to-modify-json-data-stored-in-files">Does Mock Server Has Any Utility To Modify JSON Data Stored In Files?</h2>
<p>Yes - Mock Server exposes <code class="highlighter-rouge">transpose</code> option that cna be passed in <code class="highlighter-rouge">respondWithFile</code> method to modify the JSON files dynamically.</p>

<p><br /></p>

<h2 id="how-does-transposedata-work-to-modify-json-data-stored-in-files">How Does <code class="highlighter-rouge">transposeData</code> Work To Modify JSON Data Stored In Files?</h2>
<p>If you have many variants for a Rest end point and the mocked data for all variants can use the same JSON response with few changes to the values, than this feature is what you need. This feature allows you to dynamically change a JSON file before sending the response back from the mock server for the request. It removes the need of having one to one mapping of static JSON files with each variants.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">// Static Response JSON File</span>
<span class="p">{</span>
 <span class="nl">id</span><span class="p">:</span> <span class="s2">"1234"</span><span class="p">,</span>
 <span class="nx">name</span><span class="err">:</span> <span class="s2">"toothpaste"</span>
 <span class="nl">details</span><span class="p">:</span> <span class="p">[</span>
   <span class="p">{</span>
    <span class="na">flavor</span><span class="p">:</span> <span class="s2">"Mint 1"</span><span class="p">,</span>
    <span class="na">Size</span><span class="p">:</span> <span class="s2">"10"</span><span class="p">,</span>
    <span class="na">Size_Type</span><span class="p">:</span> <span class="nx">ounce</span>
    <span class="p">},</span>
   <span class="p">{</span>
    <span class="na">flavor</span><span class="p">:</span> <span class="s2">"Mint"</span><span class="p">,</span>
    <span class="na">Size</span><span class="p">:</span> <span class="s2">"10"</span><span class="p">,</span>
    <span class="na">Size_Type</span><span class="p">:</span> <span class="nx">ounce</span>
   <span class="p">}</span>
 <span class="p">]</span>
<span class="p">}</span>

<span class="c1">// Sample code for substituting id from 1234 to 7777 and flavor from Mint to Mint 2 for second array element in routes</span>
<span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="s1">'Get Collection'</span><span class="p">,</span>
    <span class="na">label</span><span class="p">:</span> <span class="s1">'Get Collections'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="s1">'/product/grouping/api/collection/{collectionId}'</span><span class="p">,</span>
 
    <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">dataToChange</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'id'</span><span class="p">:</span> <span class="s1">'7777'</span><span class="p">,</span>
        <span class="s1">'details[1].flavor'</span><span class="p">:</span> <span class="s1">'Mint 2'</span>
      <span class="p">}</span>
      <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">respondWithFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">reply</span><span class="p">,</span> <span class="p">{</span><span class="na">transpose</span><span class="p">:</span> <span class="nx">dataToChange</span><span class="p">});</span> 
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Dynamic Response JSON File returned from Mock service</span>
<span class="p">{</span>
 <span class="nl">id</span><span class="p">:</span> <span class="s2">"7777"</span><span class="p">,</span>
 <span class="na">name</span><span class="p">:</span> <span class="s2">"toothpaste"</span>
 <span class="na">details</span><span class="p">:</span> <span class="p">[</span>
   <span class="p">{</span>
    <span class="na">flavor</span><span class="p">:</span> <span class="s2">"Mint 1"</span><span class="p">,</span>
    <span class="na">Size</span><span class="p">:</span> <span class="s2">"10"</span><span class="p">,</span>
    <span class="na">Size_Type</span><span class="p">:</span> <span class="nx">ounce</span>
    <span class="p">},</span>
   <span class="p">{</span>
    <span class="na">flavor</span><span class="p">:</span> <span class="s2">"Mint 2"</span><span class="p">,</span>
    <span class="na">Size</span><span class="p">:</span> <span class="s2">"10"</span><span class="p">,</span>
    <span class="na">Size_Type</span><span class="p">:</span> <span class="nx">ounce</span>
   <span class="p">}</span>
 <span class="p">]</span>
<span class="p">}</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="can-i-use-transposedata-functionality-outside-of-respondwithfile">Can I Use <code class="highlighter-rouge">transposeData</code> Functionality Outside Of <code class="highlighter-rouge">respondWithFile</code>?</h2>
<p>Yes - You can use it by Shifu Utils.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fileLocation</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"path"</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'./resources/test-data/data-transposition-test.json'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">dataSet</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">readJsonFile</span><span class="p">(</span><span class="nx">fileLocation</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">dataToChange</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s1">'items.item[0].id'</span><span class="p">:</span> <span class="mi">1234</span><span class="p">,</span> <span class="c1">// substitue id 0001 to 1234</span>
 <span class="s1">'items.item[0].val'</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">,</span> <span class="c1">// Add 'val' to first array element of items.item</span>
 <span class="s1">'items.item[1].id'</span><span class="p">:</span> <span class="mi">4567</span><span class="p">,</span> <span class="c1">// Add 'id' to second array element of items.item</span>
 <span class="s1">'items.item[0].batters.batter[0].id'</span><span class="p">:</span> <span class="mi">5678</span> <span class="c1">// substitue id 1001 to 5678</span>
<span class="p">}</span>
<span class="nx">substitutedData</span> <span class="o">=</span> <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">transposeData</span><span class="p">(</span><span class="nx">dataSet</span><span class="p">,</span> <span class="nx">dataToChange</span><span class="p">);</span>

<span class="c1">// Base JSON file - data-transposition-test.json</span>
<span class="p">{</span>
  <span class="s2">"items"</span><span class="err">:</span>
  <span class="p">{</span>
    <span class="s2">"item"</span><span class="err">:</span>
    <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"0001"</span><span class="p">,</span>
        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"donut"</span><span class="p">,</span>
        <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Cake"</span><span class="p">,</span>
        <span class="s2">"ppu"</span><span class="p">:</span> <span class="mf">0.55</span><span class="p">,</span>
        <span class="s2">"batters"</span><span class="p">:</span>
        <span class="p">{</span>
          <span class="s2">"type"</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s2">"batter"</span><span class="p">:</span>
          <span class="p">[</span>
            <span class="p">{</span> <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"1001"</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"Regular"</span> <span class="p">},</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"topping"</span><span class="p">:</span>
        <span class="p">[</span>
          <span class="p">{</span> <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"5001"</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"None"</span> <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Resulted JSON</span>
<span class="p">{</span>
  <span class="s2">"items"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"item"</span><span class="err">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">1234</span><span class="p">,</span>
        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"donut"</span><span class="p">,</span>
        <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Cake"</span><span class="p">,</span>
        <span class="s2">"ppu"</span><span class="p">:</span> <span class="mf">0.55</span><span class="p">,</span>
        <span class="s2">"val"</span><span class="p">:</span> <span class="s2">"value"</span>
        <span class="s2">"batters"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"type"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s2">"batter"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">"id"</span><span class="p">:</span> <span class="mi">5678</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"Regular"</span><span class="p">}</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"topping"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span><span class="s2">"id"</span><span class="p">:</span> <span class="s2">"5001"</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"None"</span><span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">4567</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="why-mock-server-returns-error-415-unsupported-media-type">Why Mock Server Returns Error 415 Unsupported Media Type?</h2>
<p>If you’re using content type like <code class="highlighter-rouge">application/graphql</code>, follow this example</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>  <span class="nx">shifu</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="s1">'id'</span><span class="p">,</span>
    <span class="na">label</span><span class="p">:</span> <span class="s1">'id'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="s1">'/graphql'</span><span class="p">,</span>
    <span class="na">method</span><span class="p">:</span> <span class="p">[</span><span class="s1">'POST'</span><span class="p">,</span> <span class="s1">'PUT'</span><span class="p">],</span>
    <span class="na">config</span> <span class="p">:</span> <span class="p">{</span>
      <span class="na">payload</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">parse</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">allow</span><span class="p">:</span> <span class="s1">'application/graphql'</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">handler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">shifu</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">respondWithFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">reply</span><span class="p">,</span> <span class="p">{</span><span class="na">code</span><span class="p">:</span> <span class="mi">200</span><span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>
</code></pre>
</div>
<p>For more details, <a href="https://stackoverflow.com/questions/34640307/support-additional-mime-types-in-hapi">read this</a></p>

<p><br /></p>

<h2 id="how-to-send-meta-information-for-response-">How to send meta information for response ?</h2>

<p>Mocked responses can also have meta information that can be set in the response files itself. For example :</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"setHeaders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fri, 06 Jan 2017 03:33:22 GMT"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"content-type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text/html; charset=UTF-8"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"transfer-encoding"</span><span class="p">:</span><span class="w"> </span><span class="s2">"chunked"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"connection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"close"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"set-cookie"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"__cfduid=d7502270409ade5544a5a60d0fbd7652a1483673602; expires=Sat, 06-Jan-18 03:33:22 GMT; path=/; domain=.typicode.com; HttpOnly"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"x-powered-by"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Express"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"vary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Accept-Encoding"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"access-control-allow-credentials"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"cache-control"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public, max-age=14400"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"last-modified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thu, 05 Jan 2017 07:28:00 GMT"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"via"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.1 vegur"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"cf-cache-status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HIT"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"expires"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fri, 06 Jan 2017 07:33:22 GMT"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"server"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cloudflare-nginx"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"cf-ray"</span><span class="p">:</span><span class="w"> </span><span class="s2">"31cc1baee47b11fb-SJC"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"setCode"</span><span class="p">:</span><span class="mi">201</span><span class="p">,</span><span class="w">
  </span><span class="nt">"setPayload"</span><span class="p">:</span><span class="w"> </span><span class="s2">"resources/mocked-data/message/GET/file_read_from_recorded_file.txt"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"setContentType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text/plain; charset=utf-8"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>The above file is going to set the headers of the response from Shifu according to <code class="highlighter-rouge">headers</code> provided in <code class="highlighter-rouge">setHeaders</code>, <code class="highlighter-rouge">code</code> provided in <code class="highlighter-rouge">setCode</code> , <code class="highlighter-rouge">contentType</code> provided in <code class="highlighter-rouge">setContentType</code> and <code class="highlighter-rouge">payload</code> provided in <code class="highlighter-rouge">setPayload</code>. If <code class="highlighter-rouge">setPayload</code> is a path of the file intended to be responded with, then Shifu will look for the file and respond with the content of that file. If <code class="highlighter-rouge">setPayload</code> is JSON content, then Shifu will respond with JSON content.</p>

<p>The above functionality makes sure that Shifu is able to handle all the file types when responding with recorded mocked data.</p>

<p>In order to test different scenarios, you can add/delete/update header information in the <code class="highlighter-rouge">setHeaders</code> value. Or if you need to change the <code class="highlighter-rouge">contentType</code> of the response, you can simply replace value of <code class="highlighter-rouge">setContentType</code>.</p>

<p>Please note that <code class="highlighter-rouge">setContentType</code> will take precedence over <code class="highlighter-rouge">content-type</code> header value. If <code class="highlighter-rouge">setContentType</code> is not provided then, HTTP will set the contentType of the file according to file type.</p>

<p><br /></p>

<h2 id="how-to-add-shifu-custom-commands-to-nightwatch">How to add Shifu custom commands to Nightwatch?</h2>

<p>To add mock server custom commands to control the Shifu server in your end to end tests, add the following in <code class="highlighter-rouge">nightwatch.json</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>"custom_commands_path": [
    ...
    "./node_modules/shifu-magellan-nightwatch/commands"
  ],
</code></pre>
</div>


  </div>
  <div class="clear"></div>
</div>
<script type="text/javascript">
  var elements = document.getElementsByClassName('highlight');
  for (var i = 0; i < elements.length; i++) {
    elements[i].className += " line-numbers";
    if (!elements[i].parentElement.classList.value.match(/language/)) {
      elements[i].children[0].className = "language-javascript";
    }
  }
</script>
<script type="text/javascript" src="/js/prism.js"></script>
<script src="/js/jquery-3.3.1.min.js"></script>
<script src="/js/doc.js"></script>
	</div>

	<footer>
		<img class="left-footer-logo" alt="Left Footer Logo"
			 src="/documentation/images/dxt-logo.png"
			 srcset="/documentation/images/dxt-logo@2x.png 2x,
					 /documentation/images/dxt-logo@3x.png 3x">
		
		<span class="copyright">&copy; None</span>
		
		<img class="right-footer-logo" alt="Right Footer Logo"
			 src="/documentation/images/walmartlabs-logo.png"
			 srcset="/documentation/images/walmartlabs-logo@2x.png 2x,
			 		 /documentation/images/walmartlabs-logo@3x.png 3x">
	</footer>

</body>
</html>
